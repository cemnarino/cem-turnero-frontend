<!-- REEMPLAZAR LA SECCI√ìN DE PACIENTES EN index.html CON ESTE C√ìDIGO -->

<!-- ====== Pacientes ====== -->
<section id="pacientes-view" class="view">
  <h1>Gesti√≥n de Pacientes</h1>

  <!-- SELECTOR DE FLUJO -->
  <div class="flujo-selector">
    <button type="button" class="flujo-btn active" data-flujo="walkin">
      <i class="material-icons">person_add</i>
      <span>Atenci√≥n Inmediata</span>
      <small>Llega sin cita</small>
    </button>
    <button type="button" class="flujo-btn" data-flujo="agendar">
      <i class="material-icons">event</i>
      <span>Agendar Cita</span>
      <small>Reservar para despu√©s</small>
    </button>
    <button type="button" class="flujo-btn" data-flujo="checkin">
      <i class="material-icons">check_circle</i>
      <span>Check-In</span>
      <small>Paciente con cita llega</small>
    </button>
  </div>

  <!-- CONTENEDOR DE FORMULARIOS -->
  <div class="flujos-container">
    
    <!-- ========== FORMULARIO 1: WALK-IN (ATENCI√ìN INMEDIATA) ========== -->
    <form id="walkinForm" class="flujo-form active" data-flujo="walkin">
      <div class="form-header">
        <h2>
          <i class="material-icons">person_add</i>
          Atenci√≥n Inmediata (Walk-in)
        </h2>
        <p class="form-description">
          ‚úÖ Paciente llega sin cita y necesita atenci√≥n ahora
        </p>
      </div>

      <!-- Campos b√°sicos obligatorios -->
      <fieldset>
        <legend>Datos del Paciente</legend>
        
        <div class="form-row">
          <label>
            <span class="label-text">N√∫mero de Documento<span class="required">*</span></span>
            <div style="display: flex; gap: 8px;">
              <input
                type="text"
                name="numero_documento"
                id="walkin-numero-documento"
                required
                placeholder="Ej: 123456789"
                minlength="6"
                maxlength="15"
                style="flex: 1;" />
              <button type="button" class="btn-search" onclick="buscarPacienteWalkin()" title="Buscar paciente existente">
                <i class="material-icons">search</i>
              </button>
            </div>
          </label>

          <label>
            <span class="label-text">Tipo de Documento</span>
            <select name="tipo_documento">
              <option value="CEDULA">C√©dula de Ciudadan√≠a</option>
              <option value="TI">Tarjeta de Identidad</option>
              <option value="CE">C√©dula de Extranjer√≠a</option>
              <option value="PPT">Permiso de Protecci√≥n Temporal</option>
              <option value="PERMISO_TURISMO">Permiso de Turismo</option>
            </select>
          </label>
        </div>

        <div class="form-row">
          <label>
            <span class="label-text">Primer Nombre<span class="required">*</span></span>
            <input type="text" name="primer_nombre" required />
          </label>
          <label>
            <span class="label-text">Segundo Nombre</span>
            <input type="text" name="segundo_nombre" />
          </label>
        </div>

        <div class="form-row">
          <label>
            <span class="label-text">Primer Apellido<span class="required">*</span></span>
            <input type="text" name="primer_apellido" required />
          </label>
          <label>
            <span class="label-text">Segundo Apellido</span>
            <input type="text" name="segundo_apellido" />
          </label>
        </div>

        <div class="form-row">
          <label>
            <span class="label-text">Contacto (Tel√©fono)</span>
            <input type="tel" name="contacto" placeholder="Ej: 3001234567" />
          </label>
          <label>
            <span class="label-text">EPS</span>
            <input type="text" name="eps" placeholder="Ej: Salud Total" />
          </label>
        </div>
      </fieldset>

      <!-- Datos laborales -->
      <fieldset>
        <legend>Informaci√≥n Laboral</legend>
        
        <div class="form-row">
          <label>
            <span class="label-text">Empresa<span class="required">*</span></span>
            <input type="text" name="empresa" required placeholder="Nombre de la empresa" />
          </label>
          <label>
            <span class="label-text">Cargo</span>
            <input type="text" name="cargo" placeholder="Ej: Operario" />
          </label>
        </div>

        <div class="form-row">
          <label>
            <span class="label-text">AFP</span>
            <input type="text" name="afp" placeholder="Ej: Porvenir" />
          </label>
          <label>
            <span class="label-text">ARL</span>
            <input type="text" name="arl" placeholder="Ej: Positiva" />
          </label>
        </div>

        <label>
          <span class="label-text">Responsable de la Empresa</span>
          <input
            type="text"
            name="responsable_empresa"
            placeholder="Persona que agenda - Ej: Mar√≠a G√≥mez - 3009876543" />
        </label>
      </fieldset>

      <!-- Informaci√≥n del examen -->
      <fieldset>
        <legend>Informaci√≥n del Examen</legend>
        
        <label>
          <span class="label-text">Tipo de Examen<span class="required">*</span></span>
          <select name="tipo_examen" required>
            <option value="">Seleccione...</option>
            <option value="CONSULTA_GENERAL">Consulta General</option>
            <option value="LABORATORIO">Laboratorio</option>
            <option value="EXAMEN_INGRESO">Examen M√©dico de Ingreso</option>
            <option value="EXAMEN_PERIODICO">Examen M√©dico Peri√≥dico</option>
            <option value="EXAMEN_EGRESO">Examen de Egreso</option>
            <option value="EXAMEN_ALTURAS">Examen con √ânfasis en Alturas</option>
          </select>
        </label>

        <label>
          <span class="label-text">Observaci√≥n</span>
          <textarea
            name="observacion"
            rows="3"
            placeholder="Informaci√≥n adicional sobre el examen"></textarea>
        </label>

        <div class="form-row">
          <label>
            <span class="label-text">Valor (V/R)</span>
            <input type="number" name="valor" min="0" step="1000" value="0" />
          </label>
          <label>
            <span class="label-text">Consultorio<span class="required">*</span></span>
            <select name="consultorio_id" required>
              <option value="">Cargando...</option>
            </select>
          </label>
        </div>
      </fieldset>

      <div class="form-note walkin">
        <i class="material-icons">info</i>
        <span>
          <strong>Walk-in:</strong> El paciente aparecer√° inmediatamente en la lista de espera y se generar√° su turno autom√°ticamente.
        </span>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn-primary">
          <i class="material-icons">add_circle</i>
          Registrar y Asignar Turno
        </button>
        <button type="reset" class="btn-secondary">
          <i class="material-icons">clear</i>
          Limpiar
        </button>
      </div>
    </form>

    <!-- ========== FORMULARIO 2: AGENDAR CITA ========== -->
    <form id="agendarForm" class="flujo-form" data-flujo="agendar">
      <div class="form-header">
        <h2>
          <i class="material-icons">event</i>
          Agendar Cita
        </h2>
        <p class="form-description">
          üìÖ Reservar cita para una fecha futura (el paciente NO est√° aqu√≠ ahora)
        </p>
      </div>

      <!-- Fecha y hora de la cita -->
      <fieldset class="highlight">
        <legend>Fecha y Hora de la Cita</legend>
        
        <!-- Calendario de disponibilidad -->
        <div class="calendario-container">
          <div class="calendario-selectores">
            <label>
              Consultorio <span class="required">*</span>
              <select id="calendario-consultorio" required>
                <option value="">Seleccione consultorio...</option>
              </select>
            </label>
            <label>
              Fecha <span class="required">*</span>
              <input type="date" id="calendario-fecha" required />
            </label>
          </div>
          
          <div id="slots-container"></div>
          <div id="slot-confirmacion"></div>
        </div>

        <!-- Input oculto para hora_agendada (se llena autom√°ticamente) -->
        <input type="hidden" name="hora_agendada" id="hora_agendada" required />
        <input type="hidden" name="consultorio_id" id="consultorio_id" required />

        <div class="horario-info">
          <strong>‚ÑπÔ∏è Informaci√≥n:</strong>
          <ul>
            <li>Lunes a Viernes: 7:00 AM - 12:00 PM / 2:00 PM - 5:00 PM</li>
            <li>S√°bados: 7:00 AM - 12:00 PM</li>
            <li>Duraci√≥n estimada por consulta: 25 minutos</li>
          </ul>
        </div>
      </fieldset>

      <!-- Datos completos del paciente -->
      <fieldset>
        <legend>Datos del Paciente</legend>
        
        <div class="form-row">
          <label>
            <span class="label-text">N√∫mero de Documento<span class="required">*</span></span>
            <div style="display: flex; gap: 8px;">
              <input
                type="text"
                name="numero_documento"
                id="agendar-numero-documento"
                required
                placeholder="Ej: 123456789"
                minlength="6"
                maxlength="15"
                style="flex: 1;" />
              <button type="button" class="btn-search" onclick="buscarPacienteAgendar()" title="Buscar paciente existente">
                <i class="material-icons">search</i>
              </button>
            </div>
          </label>
          <label>
            <span class="label-text">Tipo de Documento</span>
            <select name="tipo_documento">
              <option value="CEDULA">C√©dula de Ciudadan√≠a</option>
              <option value="TI">Tarjeta de Identidad</option>
              <option value="CE">C√©dula de Extranjer√≠a</option>
              <option value="PPT">Permiso de Protecci√≥n Temporal</option>
              <option value="PERMISO_TURISMO">Permiso de Turismo</option>
            </select>
          </label>
        </div>

        <div class="form-row">
          <label>
            <span class="label-text">Primer Nombre<span class="required">*</span></span>
            <input type="text" name="primer_nombre" required />
          </label>
          <label>
            <span class="label-text">Segundo Nombre</span>
            <input type="text" name="segundo_nombre" />
          </label>
        </div>

        <div class="form-row">
          <label>
            <span class="label-text">Primer Apellido<span class="required">*</span></span>
            <input type="text" name="primer_apellido" required />
          </label>
          <label>
            <span class="label-text">Segundo Apellido</span>
            <input type="text" name="segundo_apellido" />
          </label>
        </div>

        <div class="form-row">
          <label>
            <span class="label-text">Contacto (Tel√©fono)</span>
            <input type="tel" name="contacto" placeholder="Ej: 3001234567" />
          </label>
          <label>
            <span class="label-text">EPS</span>
            <input type="text" name="eps" placeholder="Ej: Salud Total" />
          </label>
        </div>
      </fieldset>

      <!-- Informaci√≥n laboral completa -->
      <fieldset>
        <legend>Informaci√≥n Laboral</legend>
        
        <div class="form-row">
          <label>
            <span class="label-text">Empresa<span class="required">*</span></span>
            <input type="text" name="empresa" required placeholder="Nombre de la empresa" />
          </label>
          <label>
            <span class="label-text">Cargo</span>
            <input type="text" name="cargo" placeholder="Ej: Operario" />
          </label>
        </div>

        <div class="form-row">
          <label>
            <span class="label-text">AFP</span>
            <input type="text" name="afp" placeholder="Ej: Porvenir" />
          </label>
          <label>
            <span class="label-text">ARL</span>
            <input type="text" name="arl" placeholder="Ej: Positiva" />
          </label>
        </div>

        <label>
          <span class="label-text">Responsable de la Empresa</span>
          <input
            type="text"
            name="responsable_empresa"
            placeholder="Persona que agenda - Ej: Mar√≠a G√≥mez - 3009876543" />
        </label>
      </fieldset>

      <!-- Informaci√≥n del examen -->
      <fieldset>
        <legend>Informaci√≥n del Examen</legend>
        
        <label>
          <span class="label-text">Tipo de Examen<span class="required">*</span></span>
          <select name="tipo_examen" required>
            <option value="">Seleccione...</option>
            <option value="CONSULTA_GENERAL">Consulta General</option>
            <option value="LABORATORIO">Laboratorio</option>
            <option value="EXAMEN_INGRESO">Examen M√©dico de Ingreso</option>
            <option value="EXAMEN_PERIODICO">Examen M√©dico Peri√≥dico</option>
            <option value="EXAMEN_EGRESO">Examen de Egreso</option>
            <option value="EXAMEN_ALTURAS">Examen con √ânfasis en Alturas</option>
          </select>
        </label>

        <label>
          <span class="label-text">Observaci√≥n</span>
          <textarea
            name="observacion"
            rows="3"
            placeholder="Informaci√≥n adicional sobre el examen"></textarea>
        </label>

        <div class="form-row">
          <label>
            <span class="label-text">Valor (V/R)</span>
            <input type="number" name="valor" min="0" step="1000" value="0" />
          </label>
          <label>
            <span class="label-text">Consultorio<span class="required">*</span></span>
            <select name="consultorio_id" required>
              <option value="">Cargando...</option>
            </select>
          </label>
        </div>
      </fieldset>

      <div class="form-note agendar">
        <i class="material-icons">schedule</i>
        <span>
          <strong>Agendamiento:</strong> El paciente NO aparecer√° en la lista hasta que haga check-in el d√≠a de su cita.
        </span>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn-primary">
          <i class="material-icons">event_available</i>
          Agendar Cita
        </button>
        <button type="reset" class="btn-secondary">
          <i class="material-icons">clear</i>
          Limpiar
        </button>
      </div>
    </form>

    <!-- ========== FORMULARIO 3: CHECK-IN ========== -->
    <div id="checkinView" class="flujo-form" data-flujo="checkin">
      <div class="form-header">
        <h2>
          <i class="material-icons">check_circle</i>
          Check-In - Citas del D√≠a
        </h2>
        <p class="form-description">
          ‚úÖ Pacientes agendados que est√°n llegando ahora
        </p>
      </div>

      <!-- Filtros -->
      <div class="checkin-filters">
        <label>
          <i class="material-icons">date_range</i>
          Fecha:
          <input type="date" id="checkin-fecha" />
        </label>
        <label>
          <i class="material-icons">business</i>
          Consultorio:
          <select id="checkin-consultorio">
            <option value="">Todos</option>
          </select>
        </label>
        <button type="button" class="btn-primary" onclick="cargarCitasPendientes()">
          <i class="material-icons">refresh</i>
          Actualizar
        </button>
      </div>

      <!-- Lista de citas pendientes de check-in -->
      <div class="checkin-list">
        <h3>Pacientes Agendados (Pendientes de Llegada)</h3>
        
        <div id="checkin-empty" class="empty-state" style="display: none;">
          <i class="material-icons">event_busy</i>
          <p>No hay citas agendadas para este d√≠a</p>
        </div>

        <table id="checkinTable" style="display: none;">
          <thead>
            <tr>
              <th>Hora</th>
              <th>Paciente</th>
              <th>Documento</th>
              <th>Empresa</th>
              <th>Examen</th>
              <th>Consultorio</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <!-- Se llena din√°micamente -->
          </tbody>
        </table>
      </div>

      <div class="form-note checkin">
        <i class="material-icons">how_to_reg</i>
        <span>
          <strong>Check-in:</strong> Al hacer check-in, el paciente aparecer√° en la lista de espera y se le asignar√° su turno autom√°ticamente.
        </span>
      </div>
    </div>

  </div>

  <!-- LISTADO DE PACIENTES (mantener el actual) -->
  <section id="paciente-list-section">
    <h2>Listado de Pacientes</h2>
    <!-- El c√≥digo del listado actual se mantiene igual -->
  </section>
</section>
